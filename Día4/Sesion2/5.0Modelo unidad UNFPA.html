<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.165">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrés Gutiérrez - Stalyn Guerrero - Gabriel Nieto">

<title>Estimación de uso de métodos de planificación familiar empleando modelos de unidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="5.0Modelo unidad UNFPA_files/libs/clipboard/clipboard.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/quarto.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/popper.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/anchor.min.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="5.0Modelo unidad UNFPA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="5.0Modelo unidad UNFPA_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimación de uso de métodos de planificación familiar empleando modelos de unidad</h1>
<p class="subtitle lead">CEPAL - Unidad de Estadísticas Sociales</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrés Gutiérrez - Stalyn Guerrero - Gabriel Nieto </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>Para los gobiernos y las organizaciones internacionales es muy importante conocer las condiciones de calidad de vida de las personas en lo que incluye la salud, por lo cual, evaluar la capacidad que estas tienen para cubrir sus necesidades de planificación familiar y de acceso a diferentes métodos modernos de planificicación; es fundamental para el diseño y formulación de políticas públicas. Por esta razón, el realizar mapas de uso de métodos de planificación familiar mediante metodologías adecuadas que permitan llegar a estimaciones precisas, se convierte en una herramienta preciada para identificar no solamente las áreas geográficas más vulnerables en términos salud sexual y reproductiva (departamentos, regiones, municipios, provincias, comunas o la división geográfica característica de cada país) sino también la situación de grupos o segmentos poblacionales de interés.</p>
<section id="definiciones-de-los-indicadores-de-interés." class="level2">
<h2 class="anchored" data-anchor-id="definiciones-de-los-indicadores-de-interés.">Definiciones de los indicadores de interés.</h2>
<ul>
<li><p>Indicador D6 métodos de planificación</p>
<p>Este indicador, alude a la tasa de prevalencia de uso de métodos anticonceptivos de mujeres sin importar el tipo de método ya sea moderno, tradicional o folclórico, la cual se compone por mujeres en edad fértil (entre 15 y 49 años) y sexualmente activas</p></li>
<li><p>Indicador D6m métodos modernos de planificación</p>
<p>Este indicador, corresponde a la tasa de prevalencia que hace referencia al uso de métodos anticonceptivos de tipo moderno. la cual se compone por mujeres por mujeres en edad fértil (entre 15 y 49 años), sexualmente activas que hacen uso de algún método de tipo moderno.</p></li>
<li><p>Indicador NI necesidades insatisfechas</p>
<p>La definición de este indicador, se entiende como la tasa de prevalencia de mujeres en edad de procrear que por algún motivo no son capaces de cubrir sus necesidades de planificación familiar con algún método anticonceptivo (moderno o tradicional). Esta se compone, por mujeres en edad fértil (entre 15 a 49 años), sexualmente activas y/o unidas que afirma no ser capaces de cubrir sus necesidades de planificación familiar con algún método anticonceptivo (tradicional y/o modernos)</p></li>
<li><p>D7 (junto con necesidades insatisfechas)</p>
<p>Este indicador, hace referencia a la proporción de mujeres en edad de procrear (15 a 49 años), sexualmente activas y/o unidas que han decidido por voluntad propia no tener hijos (adicionales) o posponer su siguiente hijo y para ello se encuentran utilizando métodos anticonceptivos modernos.</p></li>
</ul>
</section>
</section>
<section id="modelo-mrp" class="level1">
<h1>Modelo MRP</h1>
<p>De acuerdo con este modelo, como lo expone Gutiérrez y otros (2022), la probabilidad de hacer uso de métodos de planificación para la <span class="math inline">\(i\)</span>-ésima persona en el <span class="math inline">\(j\)</span>-ésimo post-estrato, puede ser definido para cada unidad de la encuesta. El modelo pretende establecer la relación entre la expectativa <span class="math inline">\(\rho_{di}\)</span> de la variable dicotómica con las covariables de información auxiliar disponibles para ser incluidas. El procedimiento correspondiente a este proceso, modela el logaritmo del cociente entre la probabilidad de usar algún método anticonceptivo a su complemento en relación al conjunto de covariables a nivel de unidad, <span class="math inline">\(x_{ji}\)</span>, y el efecto aleatorio, <span class="math inline">\(u_d\)</span></p>
<p><span class="math display">\[
\ln(\frac{ρ_{ji}}{1-ρ_{ji}} ) = x_{ji}^t \beta + u_d.
\]</span></p>
<p>Los coeficientes <span class="math inline">\(\beta\)</span> hacen referencia a los efectos aleatorios de las variables <span class="math inline">\(x_{ji}^t\)</span> sobre las probabilidades de que la <span class="math inline">\(i\)</span>-ésima persona haga uso de métodos anticonceptivos y <span class="math inline">\(u_d \sim N(0,\sigma^2_u)\)</span>.</p>
<p><span class="math display">\[
\begin{eqnarray*}
\beta  &amp; \sim &amp; N(0,100) \\
\sigma^2_u &amp; \sim &amp; IG(0.00001,0.00001)
\end{eqnarray*}
\]</span></p>
<section id="estandarización-de-la-encuesta" class="level2">
<h2 class="anchored" data-anchor-id="estandarización-de-la-encuesta">Estandarización de la encuesta</h2>
<p>Se presentan las variables provenientes de la Encuesta Nacional de Salud Materno Infantil (ENSMI), que fueron empleadas para la construcción de los datos que son utilizadas en este estudio e incluidas en el ajuste del modelo.</p>
<section id="covariables" class="level4">
<h4 class="anchored" data-anchor-id="covariables">Covariables</h4>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-1_0a5d2bf90303a5a76c8ce371f910674f">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/UNFPA_cov1.png" width="800" height="650" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="indicadores" class="level4">
<h4 class="anchored" data-anchor-id="indicadores">Indicadores</h4>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-2_8b6d43c2a0894ef0c5c21259954fad9c">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/UNFPA_Indicadores.png" width="800" height="650" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El indicador de necesidades satisfechas de planificación por métodos modernos (D7) no se crea a partir de las variables originales de la encuesta, ya que es una razón entre los otros tres indicadores creados</p>
</section>
<section id="variables-para-el-diseño-muestral" class="level4">
<h4 class="anchored" data-anchor-id="variables-para-el-diseño-muestral">Variables para el diseño muestral</h4>
<ul>
<li><p>Unidad primaria de muestreo - UPM</p>
<p>Para la definifición de esta variable, se emplea la variable original de la encuesta “hv021”.</p></li>
<li><p>Estrato</p>
<p>Para la definifición de esta variable, se emplea la variable original de la encuesta “hv023”.</p></li>
<li><p>Factor de expansión - fexp</p>
<p>El factor de expansión para el cual se emplea la variable original “V005” el cual requiere que al valor de la variable se le multiplique una constante (4.641.986) la cual hace referencia al número de mujeres en edad fértil; y, a ese valor se divide por la suma de la variable(V005).</p></li>
</ul>
<p>La tabla resultante se muestra en la siguiente tabla.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-3_d2fcbaf0b6a11be910899318fc89a2bd">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6/encuesta_mrp.rds"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(encuesta_mrp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> usametodo </th>
   <th style="text-align:right;"> usamoderno </th>
   <th style="text-align:right;"> necesInst </th>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:left;"> unida </th>
   <th style="text-align:left;"> anoest </th>
   <th style="text-align:right;"> upm </th>
   <th style="text-align:right;"> estrato </th>
   <th style="text-align:right;"> fexp </th>
   <th style="text-align:right;"> pobreza </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 186.2119 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="censos-de-población-y-vivienda" class="level2">
<h2 class="anchored" data-anchor-id="censos-de-población-y-vivienda">Censos de población y vivienda</h2>
<p>Es necesario definir las variables del país con los que se desea trabajar. De acuerdo a esto, como primer paso se debe tener acceso al censo del país, para ello puede acceder desde el siguiente enlace <a href="https://redatam.org/en/microdata" class="uri">https://redatam.org/en/microdata</a> en el cual dispondrá de un archivo <em>.zip</em> con los microdatos del país. Ahora bien, para leer el conjunto de datos, es necesario emplear la función redatam.open de la librería <code>redatam</code>, la cual depende directamente del diccionario censal del software REDATAM, este es un archivo con extensión dicx y que debe encontrarse en la carpeta sobre los datos que se están leyendo. Así, es como se crea un objeto dentro de <code>R</code> que hace la respectiva unión del diccionario con los microdatos de la base de datos censal. La siguiente sintaxis muestra la lectura del diccionario en <code>R</code> y los cálculos iniciales</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-4_af97ba3cb9d9a150795c81dca3bd417c">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(redatam)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>guatemala <span class="ot">&lt;-</span>  <span class="fu">redatam.open</span>( <span class="st">"UNFPA/D6/Data/cpv2018gtm-cde.dicx"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>CONTEOS <span class="ot">&lt;-</span> <span class="fu">redatam.query</span>(guatemala, <span class="st">"freq DEPTO.IDEPTO</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">                              by VIVIENDA.PLG11</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">                              by  PERSONA.PCP7</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">                              by PERSONA.PCP6</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">                              by PERSONA.ANEDUCA</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">                              by PERSONA.PCP34</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">                              by PERSONA.PBLOPER"</span>,<span class="at">tot.omit =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminando totales de la tabla</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>CONTEOS2 <span class="ot">&lt;-</span> CONTEOS <span class="sc">%&gt;%</span> <span class="fu">filter_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"_label"</span>)),<span class="fu">all_vars</span>(. <span class="sc">!=</span>  <span class="st">"__tot__"</span>))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">#### elimando las edades menores a 10 años </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>CONTEOS2 <span class="ot">&lt;-</span> CONTEOS2 <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(PCP73_value <span class="sc">&gt;=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Después de realizar algunas validaciones se estandarizan las variables como muestra el siguiente código.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-5_03c31ef1f504c78602d8139cc8b2c760">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> CONTEOS2 <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">depto =</span> <span class="fu">str_pad</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> IDEPTO1_value,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">2</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad =</span> <span class="st">"0"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span> <span class="fu">case_when</span>(PLG112_value <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># 1 = Urbana</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"0"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 0 = Rural</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sexo =</span> <span class="fu">as.character</span>(PCP64_value),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    PCP73_value <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span> <span class="sc">~</span>  <span class="st">"1"</span>,       <span class="co"># 0 a 14</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    PCP73_value <span class="sc">%in%</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">~</span> <span class="st">"2"</span>,      <span class="co"># 15 a 20</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    PCP73_value <span class="sc">%in%</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span> <span class="sc">~</span> <span class="st">"3"</span>,      <span class="co"># 21 a 30</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    PCP73_value <span class="sc">%in%</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">39</span> <span class="sc">~</span> <span class="st">"4"</span>,      <span class="co"># 31 a 39</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    PCP73_value <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">49</span> <span class="sc">~</span> <span class="st">"5"</span>,      <span class="co"># 40 a 49</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"6"</span>                         <span class="co"># 50 o mas</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  ),     </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">anoest =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(ANEDUCA5_value) <span class="sc">|</span> PCP73_value <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"98"</span>,     <span class="co"># No aplica</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ANEDUCA5_value <span class="sc">==</span> <span class="dv">99</span> <span class="sc">~</span> <span class="st">"99"</span>, <span class="co">#NS/NR</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    ANEDUCA5_value <span class="sc">%in%</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"1"</span>,  <span class="co"># Sin educacion</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    ANEDUCA5_value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">~</span> <span class="st">"2"</span>,  <span class="co"># 1-6</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    ANEDUCA5_value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">~</span> <span class="st">"3"</span>,  <span class="co"># 7-12</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ANEDUCA5_value <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"4"</span> ,  <span class="co"># 12 o mas</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Error"</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  ),    </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">etnia =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    PBLOPER7_value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">~</span> <span class="st">"2"</span>,    <span class="co"># Afro</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    PBLOPER7_value <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># Indigena,</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"3"</span> <span class="co"># Otro</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">unida =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    PCP346_value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">~</span> <span class="st">"1"</span>,<span class="co"># Unido</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"2"</span> <span class="co"># Otro</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  value</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(depto, area, etnia, sexo, edad, anoest, unida) <span class="sc">%&gt;%</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(value), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La tabla resultante se muestra en la siguiente tabla.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-6_694e4fbac25709b4371d514291cb9ad8">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6/censo_mrp.rds"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(censo_mrp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:left;"> sexo </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> anoest </th>
   <th style="text-align:left;"> unida </th>
   <th style="text-align:right;"> n </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 157 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 536 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 4588 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 333 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 3085 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 41 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 2025 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 877 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="imagenes-satelitales-como-información-auxiliar" class="level2">
<h2 class="anchored" data-anchor-id="imagenes-satelitales-como-información-auxiliar">Imagenes satelitales como información auxiliar</h2>
<p>En la actualidad los datos satelitales que se usan para los diferentes estudios realizados por CEPAL, se obtienen de la plataforma Google Earth Engine ; la cual, integra diferentes lenguajes de programación como Javascript, Python y R mediante el paquete rgee, recientemente vinculado (2021). Todas estas herramientas juntas, permiten obtener imágenes satelitales de los lugares de interés para integrar a la información que ya se tiene disponible y así mejorar la calidad de las estimaciones.</p>
<p>La información satelital empleada para el calculo de los indicadores es la siguiente:</p>
<ul>
<li><p>Luces nocturnas</p>
<p>En su nombre original “Nighttime Lights Time Series Version 4, Defense Meteorological Program Operational Linescan System”. Este es un sistema de datos de uso público, recopilados por la Agencia Meteorológica de la Fuerza Aérea de EE. UU. Pero el procesamiento de las imágenes y los datos es realizado por el Centro Nacional de Datos Geofísicos de la NOAA.</p></li>
<li><p>Urbanismo y evolución de superficie terrestre</p>
<p>En su nombre original “Copernicus Global Land Cover Layers: CGLS-LC100 Collection 3” Estos mapas se encuentran disponibles para los periodos 2015-2019 en todo el mundo. Este esquema de clasificación según Google, puede representar áreas de cobertura terrestre heterogénea mejor que el esquema de clasificación estándar y, como tal, se puede adaptar para el uso de diferentes aplicaciones, por ejemplo, monitoreo forestal, monitoreo de cultivos, biodiversidad y conservación, monitoreo ambiental y seguridad en África, modelado climático, entre muchos otros.</p></li>
</ul>
<p>La base consolidada es se muestra a continuación:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-7_51cbe99031b297fad04edc3250c3c00c">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6/statelevel_predictors_df.rds"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(statelevel_predictors_df <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0.0340 </td>
   <td style="text-align:right;"> 58252.212 </td>
   <td style="text-align:right;"> 29301.486 </td>
   <td style="text-align:right;"> 32163.078 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.0351 </td>
   <td style="text-align:right;"> 5782.600 </td>
   <td style="text-align:right;"> 50116.620 </td>
   <td style="text-align:right;"> 1961.031 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.0230 </td>
   <td style="text-align:right;"> 11126.133 </td>
   <td style="text-align:right;"> 5309.722 </td>
   <td style="text-align:right;"> 4290.549 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 13712.380 </td>
   <td style="text-align:right;"> 23842.302 </td>
   <td style="text-align:right;"> 6343.604 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.0525 </td>
   <td style="text-align:right;"> 33372.522 </td>
   <td style="text-align:right;"> 169549.094 </td>
   <td style="text-align:right;"> 10789.733 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.0305 </td>
   <td style="text-align:right;"> 10578.698 </td>
   <td style="text-align:right;"> 89664.823 </td>
   <td style="text-align:right;"> 2718.639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.0143 </td>
   <td style="text-align:right;"> 8857.471 </td>
   <td style="text-align:right;"> 10941.416 </td>
   <td style="text-align:right;"> 4761.212 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.0161 </td>
   <td style="text-align:right;"> 9585.639 </td>
   <td style="text-align:right;"> 13898.204 </td>
   <td style="text-align:right;"> 6778.992 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.0207 </td>
   <td style="text-align:right;"> 21005.004 </td>
   <td style="text-align:right;"> 41919.635 </td>
   <td style="text-align:right;"> 13931.820 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.0338 </td>
   <td style="text-align:right;"> 12891.231 </td>
   <td style="text-align:right;"> 75298.055 </td>
   <td style="text-align:right;"> 4314.184 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="estimación-del-modelo-para-d6" class="level2">
<h2 class="anchored" data-anchor-id="estimación-del-modelo-para-d6">Estimación del modelo para D6</h2>
<p>Se debe cargar el archivo <code>encuesta_mrp.rds</code> y el archivo <code>statelevel_predictors_df.rds</code> creado previamente. A continuaciones preparamos los datos para el indicador <em>D6</em></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-8_af92ba7f7c7fad1f1270e555b8cec66f">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"depto"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,  </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"unida"</span> )  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>encuesta_df_agg <span class="ot">&lt;-</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byAgrega)) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">pobres =</span> <span class="fu">sum</span>(usametodo), <span class="co">#D6</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">nopobres =</span> n <span class="sc">-</span> usametodo, <span class="at">.groups =</span> <span class="st">"drop"</span>) </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>encuesta_df_agg <span class="sc">%&lt;&gt;%</span> <span class="fu">inner_join</span>(statelevel_predictors_df, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="st">"depto"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con la información ordenada ajustamos el siguiente modelo</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-9_76afde99bc1b57d3b9e09388306c56f6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstantools)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">stan_glmer</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(pobres, nopobres) <span class="sc">~</span>  (<span class="dv">1</span> <span class="sc">|</span> depto) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> edad) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> area) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> anoest) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> etnia) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> depto<span class="sc">:</span>area) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> depto<span class="sc">:</span>etnia) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> depto<span class="sc">:</span>edad) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> depto<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> area<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> etnia<span class="sc">:</span>edad) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> etnia<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> edad<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    tasa_desocupacion <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    stable_lights <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    crops.coverfraction <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    urban.coverfraction <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    unida,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),         </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> encuesta_df_agg,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cores =</span> <span class="dv">7</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iter =</span> <span class="dv">1000</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-10_13b51deaa7c6ef43c7b647a3a544d374">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"UNFPA/D6/fit_bayes.rds"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>depto <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
   <th style="text-align:right;"> unida2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0.0794 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.0693 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.0802 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.0594 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.0338 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.1227 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.0497 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.0157 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.0587 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.0873 </td>
   <td style="text-align:right;"> 9.7709 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.5396 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="validación-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="validación-del-modelo">Validación del modelo</h2>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-11_5c31dd6e1445ef2f58d7b59180450a8b">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(posterior)<span class="sc">$</span>parameters</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"depto:</span><span class="sc">\\</span><span class="st">d"</span>,<span class="at">x =</span> parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(fit, <span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-12_c84882cbb219a5a9aa2bacbb3407518c">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(fit,<span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-13_b8bbf3e01ad2d731e3d7e5d54f59c694">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(encuesta_mrp, statelevel_predictors_df)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> encuesta_mrp2)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(encuesta_mrp2<span class="sc">$</span>usametodo), y_pred2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="predicción-en-el-censo" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-14_9b6a0e750ce2da373a86d7f88de5ba41">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"depto"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-15_4b5e65889939b3afa4c77ec2977dda52">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-16_e64ea1306c8c41a92f5454f664c91d0b">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(epred_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="metodología-de-benchmarking" class="level1">
<h1>Metodología de Benchmarking</h1>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-17_5246ef8f1bac2f2b404c4ab5765a7348">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span> , <span class="st">"area"</span> ,  <span class="st">"etnia"</span> , <span class="st">"edad"</span> ,  <span class="st">"anoest"</span>, <span class="st">"unida"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-18_877d2b9da996ed1f36a88aab669e0fa1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> usametodo)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 447171.01 </td>
   <td style="text-align:right;"> 0.4574 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 26969.27 </td>
   <td style="text-align:right;"> 0.4616 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 43373.09 </td>
   <td style="text-align:right;"> 0.4348 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 68863.24 </td>
   <td style="text-align:right;"> 0.3600 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 110193.82 </td>
   <td style="text-align:right;"> 0.5182 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 61262.03 </td>
   <td style="text-align:right;"> 0.4981 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 37792.52 </td>
   <td style="text-align:right;"> 0.3152 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 34335.49 </td>
   <td style="text-align:right;"> 0.2589 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 106548.73 </td>
   <td style="text-align:right;"> 0.3532 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 71411.51 </td>
   <td style="text-align:right;"> 0.4569 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-19_aa27811c24aafc424fe86b167ee6abcf">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>( poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"anoest"</span>),epred_mat) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> anoest </th>
   <th style="text-align:right;"> anoest_1 </th>
   <th style="text-align:right;"> anoest_2 </th>
   <th style="text-align:right;"> anoest_3 </th>
   <th style="text-align:right;"> anoest_4 </th>
   <th style="text-align:right;"> epred_mat </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.3004 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.3004 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0331 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0331 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.3459 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.3459 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0404 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0404 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4265 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4265 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0561 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0561 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4404 </td>
   <td style="text-align:right;"> 0.4404 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0602 </td>
   <td style="text-align:right;"> 0.0602 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.3770 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.3770 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0487 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0487 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-20_08c7e6864e7b978c63b1c63633ef13e5">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-21_4e14bb327ec697ffa7afb32d779dd837">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-22_8e8e3cd03bff65b0082a49dd2e8cd10c">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-23_0be771648441da1d48392d8099ed1aa7">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0.4574 </td>
   <td style="text-align:right;"> 0.4573 </td>
   <td style="text-align:left;"> depto01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.4616 </td>
   <td style="text-align:right;"> 0.4610 </td>
   <td style="text-align:left;"> depto02 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.4348 </td>
   <td style="text-align:right;"> 0.4343 </td>
   <td style="text-align:left;"> depto03 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.3600 </td>
   <td style="text-align:right;"> 0.3599 </td>
   <td style="text-align:left;"> depto04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.5182 </td>
   <td style="text-align:right;"> 0.5179 </td>
   <td style="text-align:left;"> depto05 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.4981 </td>
   <td style="text-align:right;"> 0.4977 </td>
   <td style="text-align:left;"> depto06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.3152 </td>
   <td style="text-align:right;"> 0.3150 </td>
   <td style="text-align:left;"> depto07 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.2589 </td>
   <td style="text-align:right;"> 0.2587 </td>
   <td style="text-align:left;"> depto08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.3532 </td>
   <td style="text-align:right;"> 0.3531 </td>
   <td style="text-align:left;"> depto09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.4569 </td>
   <td style="text-align:right;"> 0.4567 </td>
   <td style="text-align:left;"> depto10 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-24_63acd0bf43fd129702e39f49cc97cffa">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/funciones_mrp.R"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"depto"</span>, <span class="st">"etnia"</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>plot_uni<span class="sc">$</span>depto<span class="sc">$</span>Plot<span class="sc">$</span>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span>  plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1) <span class="sc">/</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="estimación-y-mapa-del-indicador." class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-25_31ef0be99502380aa6e2c5f953149107">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(depto) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-26_4a77ea0f732e15ded65294884b1deb63">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>El cuadrado medio del error lo obtenemos con la función <code>Aux_Agregado</code> que hemos usado previamente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-27_d94fca4d1daa72b9c9536dd9e521c851">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mrp_cme <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Aux_Agregado</span>(<span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">epredmat =</span> epred_mat,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">byMap =</span> <span class="st">"depto"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mrp_estimate)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> dat_depto <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(mrp_cme) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mrp_cv =</span> mrp_estimate_se<span class="sc">/</span>Benchmarking_estimate<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mrp_cv))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(dat_depto <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> Benchmarking_estimate </th>
   <th style="text-align:right;"> mrp_estimate_se </th>
   <th style="text-align:right;"> mrp_cv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.2587 </td>
   <td style="text-align:right;"> 0.0112 </td>
   <td style="text-align:right;"> 4.3398 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 14 </td>
   <td style="text-align:right;"> 0.3002 </td>
   <td style="text-align:right;"> 0.0104 </td>
   <td style="text-align:right;"> 3.4570 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 12 </td>
   <td style="text-align:right;"> 0.3296 </td>
   <td style="text-align:right;"> 0.0113 </td>
   <td style="text-align:right;"> 3.4328 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.3150 </td>
   <td style="text-align:right;"> 0.0106 </td>
   <td style="text-align:right;"> 3.3765 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 13 </td>
   <td style="text-align:right;"> 0.3362 </td>
   <td style="text-align:right;"> 0.0113 </td>
   <td style="text-align:right;"> 3.3534 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:right;"> 0.3361 </td>
   <td style="text-align:right;"> 0.0112 </td>
   <td style="text-align:right;"> 3.3376 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 21 </td>
   <td style="text-align:right;"> 0.3525 </td>
   <td style="text-align:right;"> 0.0117 </td>
   <td style="text-align:right;"> 3.3221 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 0.3741 </td>
   <td style="text-align:right;"> 0.0117 </td>
   <td style="text-align:right;"> 3.1291 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.3531 </td>
   <td style="text-align:right;"> 0.0109 </td>
   <td style="text-align:right;"> 3.0859 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 15 </td>
   <td style="text-align:right;"> 0.3656 </td>
   <td style="text-align:right;"> 0.0111 </td>
   <td style="text-align:right;"> 3.0283 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="mapas-para-el-indicador-d6" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d6">Mapas para el indicador D6</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-28_4ffa6dd5cc12c82b785027e83d2487a3">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Shape/departamentos_gtm.shp"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">depto =</span> <span class="fu">str_pad</span>(departamen, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">width =</span> <span class="dv">2</span>), <span class="at">area =</span> <span class="cn">NULL</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_depto,  <span class="at">by =</span> <span class="st">"depto"</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="dv">1</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D6"</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-d6m-uso-de-métodos-anticonceptivos" class="level1">
<h1>Estimación del indicador D6m (Uso de métodos anticonceptivos)</h1>
<p>El procedimiento descrito previamente se repite para los indicadores <em>D6m</em> y <em>NI</em>.</p>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-29_4c7888862df6db2af1db7611979a2028">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6m/encuesta_mrp.rds"</span>) </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6m/statelevel_predictors_df.rds"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6m/censo_mrp.rds"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6m/fit_bayes.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por el proceso de estandarizado realizado es renombrado el indicador <em>usamoderno</em> como <em>probreza</em>, el modelo contemplado para el indicador es:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-30_ad714ce09ec3a4fd16470802b5c15bf0">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>call</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glmer(formula = cbind(pobres, nopobres) ~ (1 | depto) + 
    (1 | edad) + (1 | area) + (1 | anoest) + (1 | etnia) + (1 | 
    depto:area) + (1 | depto:etnia) + (1 | depto:edad) + (1 | 
    depto:anoest) + (1 | area:etnia) + (1 | area:anoest) + (1 | 
    etnia:edad) + (1 | etnia:anoest) + (1 | edad:anoest) + tasa_desocupacion + 
    stable_lights + crops.coverfraction + urban.coverfraction, 
    data = encuesta_df_agg, family = binomial(link = "logit"), 
    verbose = TRUE, cores = 7, chains = 4, iter = 500)</code></pre>
</div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-31_7c5685d17ef6329ff4f7d7157fc8e160">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>depto <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> -1.1562 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> -1.1333 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> -1.1412 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> -1.1514 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> -1.1800 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> -1.0650 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> -1.2348 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> -1.2430 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> -1.1271 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> -1.1185 </td>
   <td style="text-align:right;"> 10.5732 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="validación-del-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="validación-del-modelo-1">Validación del modelo</h2>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-32_479ebe739ee441632f8d294b8168ee4e">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(posterior)<span class="sc">$</span>parameters</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"depto:</span><span class="sc">\\</span><span class="st">d"</span>,<span class="at">x =</span> parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(fit, <span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-33_4eba499b7ffbbd311913a2a67889f530">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(fit,<span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-34_1a239e50d0e780df582b75213a8f0b3b">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(encuesta_mrp, statelevel_predictors_df)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> encuesta_mrp2)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(encuesta_mrp2<span class="sc">$</span>usamoderno), y_pred2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="predicción-en-el-censo-1" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-1">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-35_4729f86353215a6aa8b7976342613c59">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a> byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"unida"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"depto"</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-36_113b5b446e9c5764bfadf59c0c293b9e">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-37_d1cc7814f7fcd5ebfbcb9ec14ad2c7fc">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(epred_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmarking" class="level3">
<h3 class="anchored" data-anchor-id="benchmarking">Benchmarking</h3>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-38_48387c3fab510e84f89a751ad5a283c1">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span> , <span class="st">"area"</span> ,  <span class="st">"etnia"</span> , <span class="st">"edad"</span> ,  <span class="st">"anoest"</span>, <span class="st">"unida"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-39_fd661dfc6f801f9a2a1951040ad30949">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> usamoderno)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 387784.90 </td>
   <td style="text-align:right;"> 0.3966 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 23276.32 </td>
   <td style="text-align:right;"> 0.3984 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 33963.07 </td>
   <td style="text-align:right;"> 0.3404 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 50971.61 </td>
   <td style="text-align:right;"> 0.2665 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 96647.50 </td>
   <td style="text-align:right;"> 0.4545 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 52433.86 </td>
   <td style="text-align:right;"> 0.4263 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 22173.49 </td>
   <td style="text-align:right;"> 0.1850 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 22472.41 </td>
   <td style="text-align:right;"> 0.1694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 90287.68 </td>
   <td style="text-align:right;"> 0.2993 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 59763.34 </td>
   <td style="text-align:right;"> 0.3824 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-40_11c60dd46669ba9ca4c7753ba776b00a">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-41_1e779c78d47893d6c211b367f50285ab">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-42_9b40c5329c4597f42d984bf6eeefe27e">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-43_ea591f1c3b5da388a45721fbc4e90fd9">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-44_850797ed899274cf5cc18056d2318ee9">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0.3966 </td>
   <td style="text-align:right;"> 0.3966 </td>
   <td style="text-align:left;"> depto01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.3984 </td>
   <td style="text-align:right;"> 0.3979 </td>
   <td style="text-align:left;"> depto02 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.3404 </td>
   <td style="text-align:right;"> 0.3401 </td>
   <td style="text-align:left;"> depto03 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.2665 </td>
   <td style="text-align:right;"> 0.2664 </td>
   <td style="text-align:left;"> depto04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.4545 </td>
   <td style="text-align:right;"> 0.4543 </td>
   <td style="text-align:left;"> depto05 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.4263 </td>
   <td style="text-align:right;"> 0.4260 </td>
   <td style="text-align:left;"> depto06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.1850 </td>
   <td style="text-align:right;"> 0.1848 </td>
   <td style="text-align:left;"> depto07 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.1694 </td>
   <td style="text-align:right;"> 0.1693 </td>
   <td style="text-align:left;"> depto08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.2993 </td>
   <td style="text-align:right;"> 0.2992 </td>
   <td style="text-align:left;"> depto09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.3824 </td>
   <td style="text-align:right;"> 0.3822 </td>
   <td style="text-align:left;"> depto10 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-45_30da7e4a60b799170000ace09a644266">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/funciones_mrp.R"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"depto"</span>, <span class="st">"etnia"</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>plot_uni<span class="sc">$</span>depto<span class="sc">$</span>Plot<span class="sc">$</span>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span>  plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1) <span class="sc">/</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-45-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="estimación-y-mapa-del-indicador-d6m." class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador-d6m.">Estimación y mapa del indicador D6m.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-46_15e5957cb9fafec7b08f0d0af5c7037d">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(depto) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-47_bfaf2533b0ba69240ea615e875d865cc">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>El cuadrado medio del error lo obtenemos con la función <code>Aux_Agregado</code> que hemos usado previamente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-48_57019d72517ea552c07328eddf06dfe6">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mrp_cme <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Aux_Agregado</span>(<span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">epredmat =</span> epred_mat,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">byMap =</span> <span class="st">"depto"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mrp_estimate)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> dat_depto <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(mrp_cme) <span class="sc">%&gt;%</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mrp_cv =</span> mrp_estimate_se<span class="sc">/</span>Benchmarking_estimate<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mrp_cv))</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(dat_depto <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> Benchmarking_estimate </th>
   <th style="text-align:right;"> mrp_estimate_se </th>
   <th style="text-align:right;"> mrp_cv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.1693 </td>
   <td style="text-align:right;"> 0.0102 </td>
   <td style="text-align:right;"> 6.0059 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.1848 </td>
   <td style="text-align:right;"> 0.0102 </td>
   <td style="text-align:right;"> 5.5266 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 14 </td>
   <td style="text-align:right;"> 0.2184 </td>
   <td style="text-align:right;"> 0.0104 </td>
   <td style="text-align:right;"> 4.7493 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:right;"> 0.2530 </td>
   <td style="text-align:right;"> 0.0119 </td>
   <td style="text-align:right;"> 4.7093 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 0.2652 </td>
   <td style="text-align:right;"> 0.0123 </td>
   <td style="text-align:right;"> 4.6544 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 13 </td>
   <td style="text-align:right;"> 0.2700 </td>
   <td style="text-align:right;"> 0.0123 </td>
   <td style="text-align:right;"> 4.5587 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 12 </td>
   <td style="text-align:right;"> 0.2739 </td>
   <td style="text-align:right;"> 0.0120 </td>
   <td style="text-align:right;"> 4.3900 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 15 </td>
   <td style="text-align:right;"> 0.2988 </td>
   <td style="text-align:right;"> 0.0129 </td>
   <td style="text-align:right;"> 4.3206 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 21 </td>
   <td style="text-align:right;"> 0.2848 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 4.2432 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 19 </td>
   <td style="text-align:right;"> 0.3420 </td>
   <td style="text-align:right;"> 0.0136 </td>
   <td style="text-align:right;"> 3.9898 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="mapas-para-el-indicador-d6m" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d6m">Mapas para el indicador D6m</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-49_8c22da1adf1b1ebe6cc26ceaa3ec87ff">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Shape/departamentos_gtm.shp"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">depto =</span> <span class="fu">str_pad</span>(departamen, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">width =</span> <span class="dv">2</span>), <span class="at">area =</span> <span class="cn">NULL</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_depto,  <span class="at">by =</span> <span class="st">"depto"</span>))</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="dv">1</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D6m"</span>,</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-ni-necesidades-insatisfechas" class="level1">
<h1>Estimación del indicador NI (Necesidades Insatisfechas)</h1>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-50_9e061513d35af0c8435dc951144457d0">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/encuesta_mrp.rds"</span>) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/statelevel_predictors_df.rds"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/censo_mrp.rds"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/fit_bayes.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por el proceso de estandarizado realizado es renombrado el indicador <em>necesInst</em> como <em>probreza</em>, el modelo contemplado para el indicador es:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-51_b68d20089726b015c22ba56e2b71eb43">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>call</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stan_glmer(formula = cbind(pobres, nopobres) ~ (1 | depto) + 
    (1 | edad) + (1 | area) + (1 | anoest) + (1 | etnia) + (1 | 
    depto:area) + (1 | depto:etnia) + (1 | depto:edad) + (1 | 
    depto:anoest) + (1 | area:edad) + (1 | area:anoest) + (1 | 
    etnia:edad) + (1 | etnia:anoest) + (1 | edad:anoest) + tasa_desocupacion + 
    stable_lights + crops.coverfraction + urban.coverfraction, 
    data = encuesta_df_agg, family = binomial(link = "logit"), 
    verbose = TRUE, cores = 7, chains = 4, iter = 500)</code></pre>
</div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-52_0db7abec78b1a0ed9b3e15a8cf7dc072">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>depto <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> -1.5865 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> -1.6017 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> -1.5907 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> -1.5882 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> -1.5780 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> -1.6276 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> -1.5883 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> -1.5747 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> -1.6038 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> -1.5957 </td>
   <td style="text-align:right;"> -14.1884 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="validación-del-modelo-2" class="level2">
<h2 class="anchored" data-anchor-id="validación-del-modelo-2">Validación del modelo</h2>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-53_6cbd4780cae0efc0a1a66577322b2f1f">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(posterior)<span class="sc">$</span>parameters</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"depto:</span><span class="sc">\\</span><span class="st">d"</span>,<span class="at">x =</span> parameters,<span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(fit, <span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-54_722cf2428842c8f25140ff46e4e4c5fc">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(fit,<span class="at">pars =</span> var_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-55_214045b6c90d6645f0321a3321c39bad">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(encuesta_mrp, statelevel_predictors_df)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> encuesta_mrp2)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(encuesta_mrp2<span class="sc">$</span>necesInst), y_pred2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="predicción-en-el-censo-2" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-2">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-56_dc1fe4ccca7bfac386e1f7650485d776">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>,  <span class="st">"unida"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"depto"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-57_95512f2229988b5215c1ef6ab6b2a046">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-58_8297cbc64a0a1e1206d4912d91a44122">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(epred_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmarking-1" class="level3">
<h3 class="anchored" data-anchor-id="benchmarking-1">Benchmarking</h3>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-59_4c34ff99c6f76fc777da6b6cb1f7ef60">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span> , <span class="st">"area"</span> ,  <span class="st">"etnia"</span> , <span class="st">"edad"</span> ,  <span class="st">"anoest"</span>, <span class="st">"unida"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-60_827b82dad0fbe80217909890a71277f1">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> necesInst)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 47821.712 </td>
   <td style="text-align:right;"> 0.0940 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 3020.807 </td>
   <td style="text-align:right;"> 0.0880 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 6593.382 </td>
   <td style="text-align:right;"> 0.1156 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 17518.642 </td>
   <td style="text-align:right;"> 0.1554 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 9017.538 </td>
   <td style="text-align:right;"> 0.0675 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 5576.991 </td>
   <td style="text-align:right;"> 0.0762 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 10965.716 </td>
   <td style="text-align:right;"> 0.1605 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 15522.890 </td>
   <td style="text-align:right;"> 0.2139 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 20296.441 </td>
   <td style="text-align:right;"> 0.1253 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 8630.247 </td>
   <td style="text-align:right;"> 0.0951 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-61_a2819ab55f6a2f226b76fff964a2e8b1">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-62_ccd22c54c8c9a2e96a11524ec3cc1c8a">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-63_ee0fe27a781de0c1ba408774e27f6d2c">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-64_cf842660d4d74eba1022c67f07785ff4">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-65_32b153ccad0238745ebaaa43f8304be0">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"depto"</span>,]),</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> depto1 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 0.0940 </td>
   <td style="text-align:right;"> 0.0939 </td>
   <td style="text-align:left;"> depto01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto2 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.0880 </td>
   <td style="text-align:right;"> 0.0879 </td>
   <td style="text-align:left;"> depto02 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto3 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.1156 </td>
   <td style="text-align:right;"> 0.1155 </td>
   <td style="text-align:left;"> depto03 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto4 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.1554 </td>
   <td style="text-align:right;"> 0.1553 </td>
   <td style="text-align:left;"> depto04 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto5 </td>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.0675 </td>
   <td style="text-align:right;"> 0.0674 </td>
   <td style="text-align:left;"> depto05 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto6 </td>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.0762 </td>
   <td style="text-align:right;"> 0.0761 </td>
   <td style="text-align:left;"> depto06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto7 </td>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.1605 </td>
   <td style="text-align:right;"> 0.1604 </td>
   <td style="text-align:left;"> depto07 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto8 </td>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.2139 </td>
   <td style="text-align:right;"> 0.2138 </td>
   <td style="text-align:left;"> depto08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto9 </td>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.1253 </td>
   <td style="text-align:right;"> 0.1253 </td>
   <td style="text-align:left;"> depto09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> depto10 </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.0951 </td>
   <td style="text-align:right;"> 0.0950 </td>
   <td style="text-align:left;"> depto10 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-66_7249a8dc68e5d997f92508e400c2649b">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/funciones_mrp.R"</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"depto"</span>, <span class="st">"etnia"</span>,<span class="st">"unida"</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>plot_uni<span class="sc">$</span>depto<span class="sc">$</span>Plot<span class="sc">$</span>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span>  plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1) <span class="sc">/</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>(plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-66-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="estimación-y-mapa-del-indicador.-1" class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.-1">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-67_d8b7ba529c824842f7bd5bb4f1f912c4">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(depto) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-68_ed794b833b38b84bc3bffbaeb0f3c505">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>El cuadrado medio del error lo obtenemos con la función <code>Aux_Agregado</code> que hemos usado previamente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-69_ed5365930fb73ca828e49fc0935e91ec">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>mrp_cme <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Aux_Agregado</span>(<span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">epredmat =</span> epred_mat,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">byMap =</span> <span class="st">"depto"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mrp_estimate)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> dat_depto <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(mrp_cme) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mrp_cv =</span> mrp_estimate_se<span class="sc">/</span>Benchmarking_estimate<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mrp_cv))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(dat_depto <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> Benchmarking_estimate </th>
   <th style="text-align:right;"> mrp_estimate_se </th>
   <th style="text-align:right;"> mrp_cv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 06 </td>
   <td style="text-align:right;"> 0.0761 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 13.2233 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 05 </td>
   <td style="text-align:right;"> 0.0674 </td>
   <td style="text-align:right;"> 0.0086 </td>
   <td style="text-align:right;"> 12.7256 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 0.0879 </td>
   <td style="text-align:right;"> 0.0098 </td>
   <td style="text-align:right;"> 11.1414 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:right;"> 0.0950 </td>
   <td style="text-align:right;"> 0.0103 </td>
   <td style="text-align:right;"> 10.8487 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 17 </td>
   <td style="text-align:right;"> 0.1217 </td>
   <td style="text-align:right;"> 0.0116 </td>
   <td style="text-align:right;"> 9.5194 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 11 </td>
   <td style="text-align:right;"> 0.1091 </td>
   <td style="text-align:right;"> 0.0100 </td>
   <td style="text-align:right;"> 9.2086 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 18 </td>
   <td style="text-align:right;"> 0.1202 </td>
   <td style="text-align:right;"> 0.0109 </td>
   <td style="text-align:right;"> 9.0461 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 09 </td>
   <td style="text-align:right;"> 0.1253 </td>
   <td style="text-align:right;"> 0.0110 </td>
   <td style="text-align:right;"> 8.7647 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 19 </td>
   <td style="text-align:right;"> 0.1438 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 8.4089 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 0.1155 </td>
   <td style="text-align:right;"> 0.0093 </td>
   <td style="text-align:right;"> 8.0627 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="mapas-para-el-indicador-ni" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-ni">Mapas para el indicador NI</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-70_66f764227fa8405fa9178f3b636f381b">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Shape/departamentos_gtm.shp"</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">depto =</span> <span class="fu">str_pad</span>(departamen, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">width =</span> <span class="dv">2</span>), <span class="at">area =</span> <span class="cn">NULL</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_depto,  <span class="at">by =</span> <span class="st">"depto"</span>))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"NI"</span>,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"YlOrRd"</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-d7" class="level1">
<h1>Estimación del indicador D7</h1>
<p>Este indicador, hace referencia a la proporción de mujeres en edad de procrear (15 a 49 años), sexualmente activas y/o unidas que han decidido por voluntad propia no tener hijos (adicionales) o posponer su siguiente hijo y para ello se encuentran utilizando métodos anticonceptivos modernos.</p>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-71_1013ef6fbb8b1ee3c58cd16a745e0367">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/encuesta_mrp.rds"</span>) </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/censo_mrp.rds"</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/statelevel_predictors_df.rds"</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_D6  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6/fit_bayes.rds"</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_D6m <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/D6m/fit_bayes.rds"</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_NI  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"UNFPA/NI/fit_bayes.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="predicción-en-el-censo-3" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-3">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-72_d829cc7ecfd3dfee3b5e0be0da73a108">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"depto"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"unida"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"depto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora debemos hacer la predicción sobre la base <em>poststrat_df</em> con los tres modelos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-73_93597dcd89379820821494f773e7604d">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para D6</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>epred_mat_D6 <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_mrp_logit_D6, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para D6m</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>epred_mat_D6m <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_mrp_logit_D6m, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para NI</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>epred_mat_NI <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_mrp_logit_NI, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El indicador <em>D7</em> se construye a partir de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-74_e306925f7c041b1ffb1504a2ecb27865">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>epred_mat_D7<span class="ot">&lt;-</span> (epred_mat_D6m <span class="sc">/</span>(epred_mat_D6 <span class="sc">+</span> epred_mat_NI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimación-y-mapa-del-indicador.-2" class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.-2">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-75_2b85557b40440a6e622d5c4a0089f88c">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="ot">&lt;-</span> <span class="fu">Aux_Agregado</span>(<span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">epredmat =</span> epred_mat_D7,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">byMap =</span> <span class="st">"depto"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mrp_cv =</span> mrp_estimate_se<span class="sc">/</span>mrp_estimate <span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mrp_cv)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> depto </th>
   <th style="text-align:right;"> mrp_estimate </th>
   <th style="text-align:right;"> mrp_estimate_se </th>
   <th style="text-align:right;"> mrp_cv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 08 </td>
   <td style="text-align:right;"> 0.3239 </td>
   <td style="text-align:right;"> 0.0219 </td>
   <td style="text-align:right;"> 6.7655 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 07 </td>
   <td style="text-align:right;"> 0.3269 </td>
   <td style="text-align:right;"> 0.0218 </td>
   <td style="text-align:right;"> 6.6633 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 14 </td>
   <td style="text-align:right;"> 0.3960 </td>
   <td style="text-align:right;"> 0.0230 </td>
   <td style="text-align:right;"> 5.7997 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 0.4085 </td>
   <td style="text-align:right;"> 0.0231 </td>
   <td style="text-align:right;"> 5.6500 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:right;"> 0.4090 </td>
   <td style="text-align:right;"> 0.0230 </td>
   <td style="text-align:right;"> 5.6176 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 13 </td>
   <td style="text-align:right;"> 0.4456 </td>
   <td style="text-align:right;"> 0.0247 </td>
   <td style="text-align:right;"> 5.5430 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:right;"> 0.4307 </td>
   <td style="text-align:right;"> 0.0223 </td>
   <td style="text-align:right;"> 5.1831 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 21 </td>
   <td style="text-align:right;"> 0.4529 </td>
   <td style="text-align:right;"> 0.0234 </td>
   <td style="text-align:right;"> 5.1757 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 12 </td>
   <td style="text-align:right;"> 0.4706 </td>
   <td style="text-align:right;"> 0.0241 </td>
   <td style="text-align:right;"> 5.1151 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 15 </td>
   <td style="text-align:right;"> 0.4687 </td>
   <td style="text-align:right;"> 0.0239 </td>
   <td style="text-align:right;"> 5.1036 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-76_cb61c467356d34f8c01412384773389d">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>dat_depto <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(mrp_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                                            mrp_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<section id="mapas-para-el-indicador-d7" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d7">Mapas para el indicador D7</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-77_9acc43d092803ec1bd83bf71f0599d12">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Shape/departamentos_gtm.shp"</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">depto =</span> <span class="fu">str_pad</span>(departamen, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">width =</span> <span class="dv">2</span>), <span class="at">area =</span> <span class="cn">NULL</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_depto,  <span class="at">by =</span> <span class="st">"depto"</span>))</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.20</span>,  <span class="fl">0.4</span>, <span class="fl">0.6</span>,  <span class="fl">0.8</span> , <span class="dv">1</span>)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mrp_estimate"</span>,</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D7"</span>,</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>