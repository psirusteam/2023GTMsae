<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.165">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrés Gutiérrez - Stalyn Guerrero">

<title>Modelo de Fay Herriot (Normal)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="3.1Fay Herriot en R y STAN_normal_files/libs/clipboard/clipboard.min.js"></script>
<script src="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/quarto.js"></script>
<script src="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/popper.min.js"></script>
<script src="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/anchor.min.js"></script>
<link href="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3.1Fay Herriot en R y STAN_normal_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="3.1Fay Herriot en R y STAN_normal_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="3.1Fay Herriot en R y STAN_normal_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="3.1Fay Herriot en R y STAN_normal_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="3.1Fay Herriot en R y STAN_normal_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="3.1Fay Herriot en R y STAN_normal_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modelo de Fay Herriot (Normal)</h1>
<p class="subtitle lead">CEPAL - Unidad de Estadísticas Sociales</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrés Gutiérrez - Stalyn Guerrero </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>El modelo de Fay Herriot FH, propuesto por Fay y Herriot (1979), es un modelo estadístico de área y es el más comúnmente utilizado, cabe tener en cuenta, que dentro de la metodología de estimación en áreas pequeñas, los modelos de área son los de mayor aplicación, ya que lo más factible es no contar con la información a nivel de individuo, pero si encontrar no solo los datos a nivel de área, sino también información auxiliar asociada a estos datos. Este modelo lineal mixto, fue el primero en incluir efectos aleatorios a nivel de área, lo que implica que la mayoría de la información que se introduce al modelo corresponde a agregaciaciones usualmente, departamentos, regiones, provincias, municipios entre otros, donde las estimaciones que se logran con el modelo se obtienen sobre estas agregaciones o subpoblaciones.</p>
<ul>
<li>El modelo FH enlaza indicadores de las áreas <span class="math inline">\(\delta_d\)</span>, <span class="math inline">\(d = 1, \cdots , D\)</span>, asumiendo que varían respeto a un vector de <span class="math inline">\(p\)</span> covariables, <span class="math inline">\(\boldsymbol{x}_d\)</span> , de forma constante. El modelo esta dado por la ecuación</li>
</ul>
<p><span class="math display">\[
\delta_d = \boldsymbol{x^T}_d\boldsymbol{\beta} + u_d ,\ \ \ \ \  d = 1, \cdots , D
\]</span></p>
<ul>
<li><span class="math inline">\(u_d\)</span> es el término de error, o el efecto aleatorio, diferente para cada área dado por</li>
</ul>
<p><span class="math display">\[
\begin{eqnarray*}
u_{d} &amp; \stackrel{iid}{\sim} &amp; \left(0,\sigma_{u}^{2}\right)
\end{eqnarray*}
\]</span></p>
<ul>
<li><p>Sin embargo, los verdaderos valores de los indicadores <span class="math inline">\(\delta_d\)</span> no son observables. Entonces, usamos el estimador directo <span class="math inline">\(\hat{\delta}^{DIR}_d\)</span> para <span class="math inline">\(\delta_d\)</span> , lo que conlleva un error debido al muestro.</p></li>
<li><p><span class="math inline">\(\hat{\delta}^{DIR}_d\)</span> todavía se considera insesgado bajo el diseño muestral.</p></li>
<li><p>Podemos definir, entonces,</p></li>
</ul>
<p><span class="math display">\[
\hat{\delta}^{DIR}_d = \delta_d + e_d, \ \ \ \ \ \ d = 1, \cdots , D
\]</span></p>
<p>donde <span class="math inline">\(e_d\)</span> es el error debido al muestreo, <span class="math inline">\(e_{d} \stackrel{ind}{\sim} \left(0,\psi\right)\)</span></p>
<ul>
<li><p>Dichas varianzas <span class="math inline">\(\psi_d = var_{\pi}\left(\hat{\delta}^{DIR}_d\mid\delta_d\right)\)</span>, <span class="math inline">\(d = 1,\cdots,D\)</span> se estiman con los microdatos de la encuesta.</p></li>
<li><p>Por tanto, el modelo se hace, <span class="math display">\[
\hat{\delta}^{DIR}_d = \boldsymbol{x^T}_d\boldsymbol{\beta} + u_d + e_d, \ \ \ \ \ \ d = 1, \cdots , D
\]</span></p></li>
<li><p>El BLUP (best linear unbiased predictor) bajo el modelo FH de <span class="math inline">\(\delta_d\)</span> viene dado por</p></li>
</ul>
<p><span class="math display">\[
    \begin{eqnarray*}
    \tilde{\delta}_{d}^{FH} &amp; = &amp; \boldsymbol{x_d}^{T}\tilde{\boldsymbol{\beta}}+\tilde{u}_{d}
    \end{eqnarray*}
\]</span></p>
<ul>
<li><p>Si sustituimos <span class="math inline">\(\tilde{u}_d = \gamma_d\left(\hat{\delta}^{DIR}_d - \boldsymbol{x_d}^{T}\tilde{\boldsymbol{\beta}} \right)\)</span> en el BLUP bajo el modelo FH, obtenemos <span class="math display">\[
\begin{eqnarray*}
\tilde{\delta}_{d}^{FH} &amp; = &amp; \gamma_d\hat{\delta}^{DIR}_{d}+(1-\gamma_d)\boldsymbol{x_d}^{T}\tilde{\boldsymbol{\beta}}
\end{eqnarray*}
\]</span> siendo <span class="math inline">\(\gamma_d=\frac{\sigma^2_u}{\sigma^2_u + \psi_d}\)</span>.</p></li>
<li><p>Habitualmente, no sabemos el verdadero valor de <span class="math inline">\(\sigma^2_u\)</span> efectos aleatorios <span class="math inline">\(u_d\)</span>.</p></li>
<li><p>Sea <span class="math inline">\(\hat{\sigma}^2_u\)</span> un estimador consistente para <span class="math inline">\(\sigma^2_u\)</span>. Entonces, obtenemos el BLUP empírico (empirical BLUP, EBLUP) de <span class="math inline">\(\delta_d\)</span> ,</p></li>
</ul>
<p><span class="math display">\[
    \begin{eqnarray*}
    \tilde{\delta}_{d}^{FH} &amp; = &amp; \hat{\gamma_d}\hat{\delta}^{DIR}_{d}+(1-\hat{\gamma_d})\boldsymbol{x_d}^{T}\hat{\boldsymbol{\beta}}
    \end{eqnarray*}
\]</span></p>
<p>donde <span class="math inline">\(\hat{\gamma_d}=\frac{\hat{\sigma}^2_u}{\hat{\sigma}^2_u + \psi_d}\)</span>.</p>
<ul>
<li>Un estimador insesgado de segundo orden del ECM (llamado el estimador Prasad-Rao) viene dado por</li>
</ul>
<p><span class="math display">\[
    \begin{eqnarray*}
    mse_{PR}\left(\tilde{\delta}_{d}^{FH}\right) &amp; = &amp; g_{1d}\left(\hat{\sigma}_{u}^{2}\right)+g_{2d}\left(\hat{\sigma}_{u}^{2}\right)+2g_{3d}\left(\hat{\sigma}_{u}^{2}\right)
    \end{eqnarray*}
     con
\]</span> con</p>
<p><span class="math display">\[
\begin{eqnarray*} g_{1d}\left(\hat{\sigma}_{u}^{2}\right) &amp; = &amp; \gamma_{d}\psi_{d}\\
g_{2d}\left(\hat{\sigma}_{u}^{2}\right) &amp; = &amp; \left(1-\gamma_{d}\right)^{2}\boldsymbol{x}^{T}\left(\sum_{d=1}^{D}\left(\sigma_{u}^{2}+\psi_{d}\right)\boldsymbol{x}_{d}\boldsymbol{x}_{d}^{T}\right)^{-1}\boldsymbol{x}_{d},\\
g_{3d}\left(\hat{\sigma}_{u}^{2}\right) &amp; = &amp; \left(1-\gamma_{d}\right)^{2}\left(\sigma_{u}^{2}+\psi_{d}\right)^{-1}\overline{var}\left(\hat{\sigma}_{u}^{2}\right),
\end{eqnarray*}
\]</span></p>
<p>donde <span class="math display">\[
\begin{eqnarray*}
\overline{var}\left(\hat{\sigma}_{u}^{2}\right) &amp; = &amp; \mathit{I}^{-1 }\left(\sigma_{u}^{2}\right)=2\left\{ \sum_{d=1}^{D}\left(\sigma_{u}^{2}+\psi_{d}\right)^{-2}\right\} ^{-1}
\end{eqnarray*}
\]</span> para un estimador REML y <span class="math inline">\(\mathit{I}\)</span> es la información Fisher</p>
<ul>
<li><p>El estimador directo no es el único insumo del modelo de áreas de Fay-Herriot; también lo es su varianza. El estimador puntual da un indicio de la localización del parámetro, y su varianza presenta el nivel de certeza o confianza sobre esta localización.</p></li>
<li><p>Al tratar con cifras provenientes de procesamientos con encuestas de hogares, es indispensable siempre tener en cuenta que el sustento inferencial recae en la estrategia de muestreo, definida como la dupla compuesta por el diseño de muestreo y el estimador escogido.</p></li>
</ul>
<p><span class="math display">\[
\begin{eqnarray*}
Y\mid\mu,\sigma_{e} &amp; \sim &amp; N\left(\mu,\sigma_{e}\right)\\
\mu &amp; = &amp; \boldsymbol{X\beta}+V
\end{eqnarray*}
\]</span></p>
<p>donde <span class="math inline">\(V \sim N(0 , \sigma_v)\)</span>.</p>
<p>Las distribuciones previas para <span class="math inline">\(\boldsymbol{\beta}\)</span> y <span class="math inline">\(\sigma^2_v\)</span></p>
<p><span class="math display">\[
\begin{eqnarray*}
\beta_k &amp; \sim   &amp; N(\mu_0, \tau^2_0)\\
\sigma^2_v &amp;\sim &amp; IG(\alpha_1,\alpha_2)
\end{eqnarray*}
\]</span></p>
<section id="procesamiento-en-r" class="level2">
<h2 class="anchored" data-anchor-id="procesamiento-en-r">Procesamiento en R</h2>
<p>Lectura de la base de datos que resultó en el paso anterior y selección de las columnas de interés</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-1_ff089bdd6019783275740f4f91b25499">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>base_FH <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/base_FH_2014.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dam2, pobreza, vardir, hat_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lectura de las covariables, las cuales son obtenidas previamente. Dado la diferencia entre las escalas de las variables es necesario hacer un ajuste a estas.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-2_0738e39e08ecf961f34d1ec71cbab824">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#00118  00720    Lagos </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/statelevel_predictors_df_dam2.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"luces_nocturnas"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"suelo_cultivos"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"suelo_urbanos"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"modifica_humana"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"tiempo_hospital"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"tiempo_hospital_no_motor"</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">scale</span>(x)<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Uniendo las dos bases de datos.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-3_13edc4daa3e86992d1d3130ef5bcba43">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>base_FH <span class="ot">&lt;-</span> <span class="fu">full_join</span>(base_FH, statelevel_predictors_df, <span class="at">by =</span> <span class="st">"dam2"</span> )</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(base_FH[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> dam2 </th>
   <th style="text-align:right;"> pobreza </th>
   <th style="text-align:right;"> vardir </th>
   <th style="text-align:right;"> hat_var </th>
   <th style="text-align:left;"> dam </th>
   <th style="text-align:right;"> luces_nocturnas </th>
   <th style="text-align:right;"> suelo_cultivos </th>
   <th style="text-align:right;"> suelo_urbanos </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 01007 </td>
   <td style="text-align:right;"> 0.2996 </td>
   <td style="text-align:right;"> 0.0131 </td>
   <td style="text-align:right;"> 0.0093 </td>
   <td style="text-align:left;"> 01 </td>
   <td style="text-align:right;"> 6.425316 </td>
   <td style="text-align:right;"> 4.354648 </td>
   <td style="text-align:right;"> 5.148490 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02001 </td>
   <td style="text-align:right;"> 0.4211 </td>
   <td style="text-align:right;"> 0.0094 </td>
   <td style="text-align:right;"> 0.0105 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 5.286546 </td>
   <td style="text-align:right;"> 5.028009 </td>
   <td style="text-align:right;"> 4.559252 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02002 </td>
   <td style="text-align:right;"> 0.4476 </td>
   <td style="text-align:right;"> 0.0290 </td>
   <td style="text-align:right;"> 0.0125 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 3.781731 </td>
   <td style="text-align:right;"> 4.867647 </td>
   <td style="text-align:right;"> 4.236113 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02003 </td>
   <td style="text-align:right;"> 0.5179 </td>
   <td style="text-align:right;"> 0.0039 </td>
   <td style="text-align:right;"> 0.0117 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 4.856416 </td>
   <td style="text-align:right;"> 5.126377 </td>
   <td style="text-align:right;"> 4.445161 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02006 </td>
   <td style="text-align:right;"> 0.5351 </td>
   <td style="text-align:right;"> 0.0202 </td>
   <td style="text-align:right;"> 0.0120 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 4.052222 </td>
   <td style="text-align:right;"> 4.628283 </td>
   <td style="text-align:right;"> 4.130218 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 02007 </td>
   <td style="text-align:right;"> 0.4423 </td>
   <td style="text-align:right;"> 0.0091 </td>
   <td style="text-align:right;"> 0.0097 </td>
   <td style="text-align:left;"> 02 </td>
   <td style="text-align:right;"> 6.641498 </td>
   <td style="text-align:right;"> 4.895508 </td>
   <td style="text-align:right;"> 5.230731 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03001 </td>
   <td style="text-align:right;"> 0.2990 </td>
   <td style="text-align:right;"> 0.0034 </td>
   <td style="text-align:right;"> 0.0076 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 6.961710 </td>
   <td style="text-align:right;"> 4.249805 </td>
   <td style="text-align:right;"> 6.328201 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03002 </td>
   <td style="text-align:right;"> 0.2658 </td>
   <td style="text-align:right;"> 0.0089 </td>
   <td style="text-align:right;"> 0.0068 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 4.070177 </td>
   <td style="text-align:right;"> 4.231679 </td>
   <td style="text-align:right;"> 4.280650 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03004 </td>
   <td style="text-align:right;"> 0.3215 </td>
   <td style="text-align:right;"> 0.0030 </td>
   <td style="text-align:right;"> 0.0077 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 5.196541 </td>
   <td style="text-align:right;"> 4.356746 </td>
   <td style="text-align:right;"> 4.719067 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 03006 </td>
   <td style="text-align:right;"> 0.3650 </td>
   <td style="text-align:right;"> 0.0079 </td>
   <td style="text-align:right;"> 0.0100 </td>
   <td style="text-align:left;"> 03 </td>
   <td style="text-align:right;"> 5.721913 </td>
   <td style="text-align:right;"> 4.300431 </td>
   <td style="text-align:right;"> 4.976970 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="preparando-los-insumos-para-stan" class="level1">
<h1>Preparando los insumos para <code>STAN</code></h1>
<p>Dividir la base de datos en dominios observados y no observados</p>
<section id="dominios-observados." class="level3">
<h3 class="anchored" data-anchor-id="dominios-observados.">Dominios observados.</h3>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-4_397f8fc48ee4abf66be979620ac7ffd6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> base_FH <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pobreza))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dominios-no-observados." class="level3">
<h3 class="anchored" data-anchor-id="dominios-no-observados.">Dominios NO observados.</h3>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-5_e0d8351f699e02e3264e049a97f43f98">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data_syn <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  base_FH <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(data_dir <span class="sc">%&gt;%</span> <span class="fu">select</span>(dam2))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(data_syn[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> dam2 </th>
   <th style="text-align:right;"> pobreza </th>
   <th style="text-align:right;"> vardir </th>
   <th style="text-align:right;"> hat_var </th>
   <th style="text-align:left;"> dam </th>
   <th style="text-align:right;"> luces_nocturnas </th>
   <th style="text-align:right;"> suelo_cultivos </th>
   <th style="text-align:right;"> suelo_urbanos </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 16012 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.505455 </td>
   <td style="text-align:right;"> 4.478813 </td>
   <td style="text-align:right;"> 4.512089 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16014 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.512824 </td>
   <td style="text-align:right;"> 4.885733 </td>
   <td style="text-align:right;"> 4.415839 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16013 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 4.050201 </td>
   <td style="text-align:right;"> 6.436918 </td>
   <td style="text-align:right;"> 4.897607 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16015 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.914447 </td>
   <td style="text-align:right;"> 7.543074 </td>
   <td style="text-align:right;"> 5.749064 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16011 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.674836 </td>
   <td style="text-align:right;"> 4.266054 </td>
   <td style="text-align:right;"> 4.154494 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16007 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.810438 </td>
   <td style="text-align:right;"> 6.130320 </td>
   <td style="text-align:right;"> 5.216818 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16017 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.749051 </td>
   <td style="text-align:right;"> 5.920236 </td>
   <td style="text-align:right;"> 4.168912 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16003 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 4.497657 </td>
   <td style="text-align:right;"> 4.271988 </td>
   <td style="text-align:right;"> 4.594661 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16010 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.958993 </td>
   <td style="text-align:right;"> 4.331455 </td>
   <td style="text-align:right;"> 4.180705 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16016 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> 16 </td>
   <td style="text-align:right;"> 3.832718 </td>
   <td style="text-align:right;"> 4.668809 </td>
   <td style="text-align:right;"> 4.661093 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="matrix-de-covariables-efectos-fijos" class="level3">
<h3 class="anchored" data-anchor-id="matrix-de-covariables-efectos-fijos">Matrix de covariables (Efectos fijos)</h3>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-6_50e7180bd97c1c6a86b6bc8fa706b064">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>formula_mod  <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="sc">~</span> sexo2 <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                         anoest2 <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                         anoest3 <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                         anoest4 <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                         edad2 <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                         edad3  <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                         edad4  <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                         edad5 <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                         etnia1 <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                         etnia2 <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                         tasa_desocupacion <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                         luces_nocturnas <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                         suelo_cultivos <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                         rezago_escolar <span class="sc">+</span> alfabeta)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Dominios observados</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula_mod, <span class="at">data =</span> data_dir)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Dominios no observados</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>Xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula_mod, <span class="at">data =</span> data_syn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para realizar la predicción del modelo es necesario validar que <span class="math inline">\(X\)</span> y <span class="math inline">\(Xs\)</span> deben tener la mismas columnas en el mismo orden.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-7_05bd44b19c7facd18f0b1e49deb7c98a">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(Xdat),<span class="fu">colnames</span>(Xs))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="fu">nrow</span>(Xs),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="fu">length</span>(temp),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Xs), temp)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>Xs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Xs,temp)[,<span class="fu">colnames</span>(Xdat)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creando lista de parámetros para <code>STAN</code></p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-8_dd9a6a1ceb81ae059ffe2cd9f6f2c174">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N1 =</span> <span class="fu">nrow</span>(Xdat),   <span class="co"># Observados.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N2 =</span> <span class="fu">nrow</span>(Xs),   <span class="co"># NO Observados.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">p  =</span> <span class="fu">ncol</span>(Xdat),       <span class="co"># Número de regresores.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X  =</span> <span class="fu">as.matrix</span>(Xdat),  <span class="co"># Covariables Observados.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> <span class="fu">as.matrix</span>(Xs),    <span class="co"># Covariables NO Observados</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y  =</span> <span class="fu">as.numeric</span>(data_dir<span class="sc">$</span>pobreza), <span class="co"># Estimación directa</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_e =</span> <span class="fu">sqrt</span>(data_dir<span class="sc">$</span>hat_var)   <span class="co"># Error de estimación</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compilando el modelo en <code>STAN</code></p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-9_caa8b51044672ddbc62ddcdcf27b5acd">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># file.edit("../Data/modelosStan/17FH_normal.stan")</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>fit_FH_normal <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../Data/modelosStan/17FH_normal.stan"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>model_FH_normal <span class="ot">&lt;-</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  fit_FH_normal<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sample_data,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 3 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 1 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 4 Iteration: 1000 / 3000 [ 33%]  (Warmup) 
Chain 2 Iteration: 2000 / 3000 [ 66%]  (Warmup) 
Chain 2 Iteration: 2001 / 3000 [ 66%]  (Sampling) 
Chain 1 Iteration: 2000 / 3000 [ 66%]  (Warmup) 
Chain 3 Iteration: 2000 / 3000 [ 66%]  (Warmup) 
Chain 1 Iteration: 2001 / 3000 [ 66%]  (Sampling) 
Chain 3 Iteration: 2001 / 3000 [ 66%]  (Sampling) 
Chain 4 Iteration: 2000 / 3000 [ 66%]  (Warmup) 
Chain 4 Iteration: 2001 / 3000 [ 66%]  (Sampling) 
Chain 2 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 2 finished in 78.2 seconds.
Chain 1 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 3 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 1 finished in 79.2 seconds.
Chain 3 finished in 78.8 seconds.
Chain 4 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 4 finished in 79.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 78.9 seconds.
Total execution time: 81.5 seconds.</code></pre>
</div>
</div>
</section>
<section id="resultados-del-modelo-para-los-dominios-observados." class="level3">
<h3 class="anchored" data-anchor-id="resultados-del-modelo-para-los-dominios-observados.">Resultados del modelo para los dominios observados.</h3>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-10_93a12e43529d208e2657a57bcb23f31f">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_FH_normal<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"theta"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(data_dir<span class="sc">$</span>pobreza), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/3.1normal/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Análisis gráfico de la convergencia de las cadenas.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-11_2c5ceac5f6e54a417c0839b821fd088a">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_FH_normal<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma2_v"</span>)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mcmc_areas</span>(model_FH_normal<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma2_v"</span>)))<span class="sc">/</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(model_FH_normal<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma2_v"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/3.1normal/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Estimación del FH de la pobreza en los dominios observados.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-12_dab8e554769e61fb723e1a6c19e16b2d">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>theta_FH <span class="ot">&lt;-</span> model_FH_normal<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span>  <span class="st">"theta"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data_dir <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pred =</span> theta_FH<span class="sc">$</span>mean, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pred_EE =</span> theta_FH<span class="sc">$</span>sd,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Cv_pred =</span> pred_EE<span class="sc">/</span>pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Estimación del FH de la pobreza en los dominios NO observados.</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-13_a9552f04af673e3a42f3891e61de0c9c">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>theta_FH_pred <span class="ot">&lt;-</span> model_FH_normal<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span>  <span class="st">"y_pred"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>data_syn <span class="ot">&lt;-</span> data_syn <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> theta_FH_pred<span class="sc">$</span>mean,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_EE =</span> theta_FH_pred<span class="sc">$</span>sd,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cv_pred =</span> pred_EE<span class="sc">/</span>pred)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(data_syn <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(dam2, pobreza, pred, pred_EE, Cv_pred ) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> dam2 </th>
   <th style="text-align:right;"> pobreza </th>
   <th style="text-align:right;"> pred </th>
   <th style="text-align:right;"> pred_EE </th>
   <th style="text-align:right;"> Cv_pred </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 16012 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.4392 </td>
   <td style="text-align:right;"> 0.1488 </td>
   <td style="text-align:right;"> 0.3387 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16014 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5461 </td>
   <td style="text-align:right;"> 0.1323 </td>
   <td style="text-align:right;"> 0.2423 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16013 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5923 </td>
   <td style="text-align:right;"> 0.1431 </td>
   <td style="text-align:right;"> 0.2415 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16015 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5488 </td>
   <td style="text-align:right;"> 0.1437 </td>
   <td style="text-align:right;"> 0.2618 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16011 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.4510 </td>
   <td style="text-align:right;"> 0.1505 </td>
   <td style="text-align:right;"> 0.3337 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16007 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5733 </td>
   <td style="text-align:right;"> 0.1512 </td>
   <td style="text-align:right;"> 0.2638 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16017 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.6705 </td>
   <td style="text-align:right;"> 0.1447 </td>
   <td style="text-align:right;"> 0.2159 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16003 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5920 </td>
   <td style="text-align:right;"> 0.1442 </td>
   <td style="text-align:right;"> 0.2436 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16010 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5761 </td>
   <td style="text-align:right;"> 0.1498 </td>
   <td style="text-align:right;"> 0.2600 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 16016 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.5965 </td>
   <td style="text-align:right;"> 0.1419 </td>
   <td style="text-align:right;"> 0.2380 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="mapa-de-pobreza" class="level1">
<h1>Mapa de pobreza</h1>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-14_14001d5c1d40bc96df4cd5c4318bd996">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>data_map <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_dir, data_syn) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dam2, pobreza, pred, pred_EE, Cv_pred )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validando valores menores que cero o mayores a uno</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-15_bb73388a350c58e2b79474f03f3d985c">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(data_map,pred<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">|</span> pred <span class="sc">&gt;</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
pobreza
</th>
<th style="text-align:right;">
pred
</th>
<th style="text-align:right;">
pred_EE
</th>
<th style="text-align:right;">
Cv_pred
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
01013
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-0.0163101
</td>
<td style="text-align:right;">
0.2132224
</td>
<td style="text-align:right;">
-13.0730407
</td>
</tr>
<tr>
<td style="text-align:left;">
09008
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0701594
</td>
<td style="text-align:right;">
0.2058605
</td>
<td style="text-align:right;">
0.1923643
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>realizando el truncado de las predicciones</p>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-16_61904cfdab7697bbb6385ead36f9b0e5">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_map <span class="ot">&lt;-</span> data_map <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">ifelse</span>(pred<span class="sc">&lt;</span><span class="dv">0</span>,<span class="dv">0</span>,pred),</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pred =</span> <span class="fu">ifelse</span>(pred<span class="sc">&gt;</span><span class="dv">1</span>,<span class="dv">1</span>,pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="0Recursos/3.1normal/unnamed-chunk-17_6ce3039a041b98e183d9765101dc0493">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Leer Shapefile del país</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../Shape/Guatemala_adm2_uscb_2020.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="at">replacement =</span> <span class="st">""</span>,<span class="at">x =</span> GEO_MATCH),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">dam =</span> <span class="fu">substr</span>(temp, <span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">dam2 =</span> <span class="fu">paste0</span>(dam,<span class="fu">str_pad</span>(<span class="fu">str_sub</span>(temp,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">width =</span> <span class="dv">3</span>,<span class="at">pad =</span> <span class="st">"0"</span>))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>mapa <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">left_join</span>(data_map,  <span class="at">by =</span> <span class="st">"dam2"</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>,<span class="fl">0.4</span>, <span class="dv">1</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  mapa <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"pobreza"</span>, <span class="st">"pred"</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mapa de pobreza"</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorNA =</span> <span class="st">"white"</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="fl">1.5</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/3.1normal/unnamed-chunk-17-1.png" style="height:120.0%" width="672"></p>
</div>
</div>
<p>Los valores en blanco en el gráfico de la derecha son lagos.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>